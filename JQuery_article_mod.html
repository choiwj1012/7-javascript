<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>

    table, tr{
      width : 100%;
      border-top: 1px dotted black;
      border-bottom: 1px dotted black;
    }

    th, td{
      width : 25%;
      border : 1px solid black;
    }

    #read_next{
      float : right;
    }

  </style>
  <script src="http://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="JQuery_article_mod.js"></script>

  <script>

    // article Controller 인스턴스 생성
    var articleController = new ArticleController();

  </script>

  <!-- 글쓰기 이벤트 핸들링 -->
  <script>
    $(document).ready(function(){

      $("#insert_button").click(function(){

        var title = $("#insert_title_text").val();
        var content = $("#insert_content_text").val();
        var writer = $("#insert_writer_text").val();

        var article = new Article(title, content, writer);
        var isSuccess = articleController.requestInsert(article);

        if(!isSuccess){
          alert("글쓰기에 실패했습니다");
          return;
        }

        var tr = $("<tr></tr>");
        var td_article_num = $("<td></td>").text(article.getArticleNum());
        var td_article_title = $("<td></td>").text(article.getArticleTitle());
        var td_article_writer = $("<td></td>").text(article.getArticleWriter());
        var td_article_readCount = $("<td></td>").text(article.getReadCount());

        tr.append(td_article_num, td_article_title, td_article_writer, td_article_readCount);
        $("tbody").append(tr);

      });

    });
  </script>

  <!-- 글삭제 이벤트 핸들링 -->
  <script>
    $(document).ready(function(){

      $("#delete_button").click(function(){

        var delete_num = $("#delete_num_text").val();
        // 먼저 repository를 삭제하고, 정상처리 된 이후에 ui쪽을 삭제한다.
        var isSuccess = articleController.requestDelete(delete_num);

        if(isSuccess){
          alert("글삭제에 성공했습니다");
        } else {
          alert("글삭제에 실패했습니다");
          return;
        }

        // .children() return value = jQuery
        // jQuery A jQuery object contains a collection of Document Object Model (DOM) elements
        // that have been created from an HTML string or selected from a document.
        // Since jQuery methods often use CSS selectors to match elements from a document,
        // the set of elements in a jQuery object is often called a set of "matched elements" or "selected elements".
        var trs = $("tbody").children();
        for(var i = 0 ; i < trs.length ; i++){
          var number = trs.eq(i).children().first().text();
          if(number == delete_num){
            trs.eq(i).remove();
            break;
          }
        }

      });
    });

  </script>

  <!-- 글수정 이벤트 핸들링 -->
  <script>
    $(document).ready(function(){

      $("#update_button").click(function(){
        var update_num = $("#update_num_text").val();
        var update_title = $("#update_title_text").val();
        var update_content = $("#update_content_text").val();
        var update_writer = $("#update_writer_text").val();

        var article = new Article(update_title, update_content, update_writer);
        article.setArticleNum(update_num);

        var isSuccess = articleController.requestUpdate(article);

        if(isSuccess){
          alert("글 수정에 성공했습니다");
        } else {
          alert("글 수정에 실패했습니다");
          return;
        }

        var trs = $("tbody").children();

        for(var i=0; i<trs.length; i++){
          var num = trs.eq(i).children().first().text();
          if(num == article.getNum()){
            trs.eq(i).children().eq(1).text(article.getArticleTitle());
            trs.eq(i).children().eq(2).text(article.getArticleWriter());
            break;
          }
        }

      });

    });
  </script>


</head>
<body>

  <!-- 글목록 -->
  <fieldset>
    <legend>글목록</legend>
    <table>
      <thead>
        <tr>
          <th>번호</th>
          <th제목></th>
          <th>작성자</th>
          <th>조회수</th>
        </tr>
      </thead>
      <tbody>

      </tbody>
    </table>
    <button id="read_prev">이전글</button>
    <button id="read_next">다음글</button>
  </fieldset>

  <!-- 글조회 -->
  <fieldset>
    <legend>글조회</legend>
    <div>
      <input type="text" id="read_num_text" placeholder="번호 입력">
      <input type="button" id="read_button" value="글조회">
    </div>
    <div id="result_read">

    </div>
  </fieldset>

  <!-- 글쓰기 -->
  <fieldset>
    <legend>글쓰기</legend>
    <div>
      <input type="text" id="insert_title_text" placeholder="제목 입력">
      <input type="text" id="insert_content_text" placeholder="내용 입력">
      <input type="text" id="insert_writer_text" placeholder="작성자 입력">
      <input type="button" id="insert_button" value="글쓰기">
    </div>
  </fieldset>

  <!-- 글삭제 -->
  <fieldset>
    <legend>글삭제</legend>
    <div>
      <input type="text" id="delete_num_text" placeholder="번호 입력">
      <input type="button" id="delete_button" value="글삭제">
    </div>
  </fieldset>

  <!-- 글수정 -->
  <fieldset>
    <legend>글수정</legend>
    <div>
      <input type="text" id="update_num_text" placeholder="번호 입력">
      <input type="text" id="update_title_text" placeholder="제목 입력">
      <input type="text" id="update_content_text" placeholder="내용 입력">
      <input type="text" id="update_writer_text" placeholder="작성자 입력">
      <input type="button" id="update_button" value="글수정">
    </div>
  </fieldset>

</body>
</html>
